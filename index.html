<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能排班系统</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Main App -->
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-calendar-alt"></i> 智能排班</h1>
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi"></i>
                    <span>已连接</span>
                </div>
            </div>
            <div class="current-date" id="currentDate"></div>
        </header>

        <!-- Main Navigation -->
        <nav class="main-nav">
            <button class="nav-btn active" data-view="employees" onclick="switchView('employees')">
                <i class="fas fa-users"></i>
                <span>员工</span>
            </button>
            <button class="nav-btn" data-view="weekly" onclick="switchView('weekly')">
                <i class="fas fa-calendar-week"></i>
                <span>本周</span>
            </button>
            <button class="nav-btn" data-view="schedule" onclick="switchView('schedule')">
                <i class="fas fa-plus-circle"></i>
                <span>排班</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- EMPLOYEES VIEW -->
            <div class="view active" id="employeesView">
                <div class="view-header">
                    <h2><i class="fas fa-users"></i> 员工管理</h2>
                    <div class="view-actions">
                        <button class="btn-icon" onclick="showAddEmployee()" title="添加员工">
                            <i class="fas fa-user-plus"></i>
                        </button>
                        <button class="btn-icon" onclick="refreshData()" title="刷新数据">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="employeeSearch" placeholder="搜索员工..." oninput="searchEmployees()">
                </div>

                <div class="position-filter">
                    <button class="filter-btn active" onclick="filterEmployees('all')">全部</button>
                    <button class="filter-btn" onclick="filterEmployees('前台/服务区')">前台/服务区</button>
                    <button class="filter-btn" onclick="filterEmployees('厨房区')">厨房区</button>
                </div>

                <div class="employee-cards" id="employeeCards">
                    <!-- 员工卡片 -->
                </div>
            </div>

            <!-- WEEKLY SCHEDULE VIEW -->
            <div class="view" id="weeklyView">
                <div class="view-header">
                    <h2><i class="fas fa-calendar-week"></i> 本周排班</h2>
                    <div class="week-nav">
                        <button class="btn-icon" onclick="changeWeek(-1)" title="上周">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="weekRange">本周</span>
                        <button class="btn-icon" onclick="changeWeek(1)" title="下周">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="weekly-schedule" id="weeklySchedule">
                    <!-- 周排班表 -->
                </div>
                
                <!-- 快速排班按钮 -->
                <div class="quick-schedule-tools">
                    <button class="btn-secondary" onclick="showSmartSchedule()">
                        <i class="fas fa-bolt"></i> 智能排班
                    </button>
                </div>
            </div>

            <!-- SCHEDULE VIEW -->
            <div class="view" id="scheduleView">
                <div class="view-header">
                    <h2><i class="fas fa-plus-circle"></i> 添加排班</h2>
                </div>

                <div class="schedule-form">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> 选择员工</label>
                        <select id="scheduleEmployee" class="select-input">
                            <option value="">选择员工</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> 日期</label>
                        <input type="date" id="scheduleDate" class="input-field">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> 工作时间段</label>
                        <div class="time-range-group">
                            <div class="time-range-inputs">
                                <input type="time" id="scheduleStart" class="input-field" value="08:00">
                                <span class="time-separator">至</span>
                                <input type="time" id="scheduleEnd" class="input-field" value="17:00">
                            </div>
                            <div class="quick-time-buttons">
                                <button class="time-preset" onclick="setTimePreset('08:00', '17:00')">早班</button>
                                <button class="time-preset" onclick="setTimePreset('12:00', '21:00')">晚班</button>
                                <button class="time-preset" onclick="setTimePreset('09:00', '18:00')">全天</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> 类型</label>
                        <div class="type-selector">
                            <button class="type-btn active" data-type="work" onclick="selectScheduleType('work')">
                                <i class="fas fa-briefcase"></i>
                                <span>上班</span>
                            </button>
                            <button class="type-btn" data-type="rest" onclick="selectScheduleType('rest')">
                                <i class="fas fa-umbrella-beach"></i>
                                <span>休息</span>
                            </button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-primary" onclick="addSchedule()">
                            <i class="fas fa-check"></i> 添加排班
                        </button>
                        <button class="btn-secondary" onclick="showQuickWeekModal()">
                            <i class="fas fa-calendar-week"></i> 快速整周
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Quick Actions Bar -->
        <div class="quick-actions-bar">
            <button class="quick-action" onclick="showTodaySchedule()">
                <i class="fas fa-calendar-day"></i>
                <span>今日</span>
            </button>
            <button class="quick-action" onclick="showStats()">
                <i class="fas fa-chart-bar"></i>
                <span>统计</span>
            </button>
            <button class="quick-action" id="shareButton" onclick="showExportOptions()">
                <i class="fas fa-share-alt"></i>
                <span>分享</span>
            </button>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Employee Detail Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEmployeeName"></h3>
                <button class="modal-close" onclick="closeModal('employeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="employee-detail-info">
                    <div class="employee-basic">
                        <div class="info-row">
                            <span class="label">职位</span>
                            <span class="value" id="modalEmployeePosition"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">本周工时</span>
                            <span class="value" id="modalWeekHours">0 小时</span>
                        </div>
                        <div class="info-row">
                            <span class="label">本月工时</span>
                            <span class="value" id="modalMonthHours">0 小时</span>
                        </div>
                    </div>

                    <div class="week-summary">
                        <h4><i class="fas fa-calendar-week"></i> 本周排班</h4>
                        <div class="week-days" id="employeeWeekDays">
                            <!-- 周排班日视图 -->
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button class="btn-action" onclick="editEmployeeSchedule()">
                            <i class="fas fa-edit"></i> 编辑排班
                        </button>
                        
                        <div class="split-buttons">
                            <button class="btn-action" onclick="copyEmployeeSchedule()">
                                <i class="fas fa-copy"></i> 复制文本
                            </button>
                            <button class="btn-action" onclick="printEmployeeSchedule()">
                                <i class="fas fa-print"></i> 打印排班
                            </button>
                        </div>
                        
                        <button class="btn-action btn-danger" onclick="deleteCurrentEmployee()">
                            <i class="fas fa-trash"></i> 删除员工
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div class="modal" id="addEmployeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> 添加员工</h3>
                <button class="modal-close" onclick="closeModal('addEmployeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="newEmployeeName" class="input-field" placeholder="请输入员工姓名" autofocus>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-briefcase"></i> 职位</label>
                    <div class="position-select">
                        <button class="position-option active" data-position="前台/服务区" onclick="selectPosition(this)">
                            <i class="fas fa-door-open"></i>
                            <span>前台/服务区</span>
                        </button>
                        <button class="position-option" data-position="厨房区" onclick="selectPosition(this)">
                            <i class="fas fa-utensils"></i>
                            <span>厨房区</span>
                        </button>
                    </div>
                </div>
                <button class="btn-primary full-width" onclick="addEmployee()">
                    <i class="fas fa-plus"></i> 添加员工
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Week Schedule Modal -->
    <div class="modal" id="quickWeekModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-week"></i> 快速整周排班</h3>
                <button class="modal-close" onclick="closeModal('quickWeekModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="quick-week-options">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> 选择员工</label>
                        <select id="quickWeekEmployee" class="select-input">
                            <option value="">选择员工</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> 工作时间</label>
                        <div class="time-group">
                            <input type="time" id="quickWeekStart" class="input-field" value="08:00">
                            <span class="time-separator">至</span>
                            <input type="time" id="quickWeekEnd" class="input-field" value="17:00">
                        </div>
                        <div class="quick-time-buttons">
                            <button class="time-preset" onclick="setQuickTimePreset('08:00', '17:00')">早班</button>
                            <button class="time-preset" onclick="setQuickTimePreset('12:00', '21:00')">晚班</button>
                            <button class="time-preset" onclick="setQuickTimePreset('09:00', '18:00')">全天</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> 工作日</label>
                        <div class="weekdays-selector" id="weekdaysSelector">
                            <!-- 工作日选择器 -->
                        </div>
                        <div class="quick-day-buttons">
                            <button class="day-preset" onclick="setAllWeekdays()">全选工作日</button>
                            <button class="day-preset" onclick="clearWeekdays()">清除所有</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> 开始日期</label>
                        <input type="date" id="quickWeekDate" class="input-field">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-redo"></i> 重复周数</label>
                        <select id="repeatWeeks" class="select-input">
                            <option value="1">1周</option>
                            <option value="2" selected>2周</option>
                            <option value="4">4周</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-primary" onclick="applyQuickWeekSchedule()">
                        <i class="fas fa-check"></i> 应用排班
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Schedule Modal -->
    <div class="modal" id="smartScheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-brain"></i> 智能排班</h3>
                <button class="modal-close" onclick="closeModal('smartScheduleModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="smart-schedule-options">
                    <div class="form-group">
                        <label><i class="fas fa-users"></i> 选择员工组</label>
                        <select id="smartGroup" class="select-input">
                            <option value="selected">当前选中员工</option>
                            <option value="all">所有员工</option>
                            <option value="front">前台/服务区</option>
                            <option value="kitchen">厨房区</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> 智能时间推荐</label>
                        <div class="smart-time-presets">
                            <button class="time-preset-card" onclick="selectSmartTime('08:00', '17:00')">
                                <div class="preset-icon">🕗</div>
                                <div class="preset-info">
                                    <div class="preset-title">标准班</div>
                                    <div class="preset-time">08:00 - 17:00</div>
                                </div>
                            </button>
                            
                            <button class="time-preset-card" onclick="selectSmartTime('06:00', '15:00')">
                                <div class="preset-icon">☀️</div>
                                <div class="preset-info">
                                    <div class="preset-title">早班</div>
                                    <div class="preset-time">06:00 - 15:00</div>
                                </div>
                            </button>
                            
                            <button class="time-preset-card" onclick="selectSmartTime('12:00', '21:00')">
                                <div class="preset-icon">🌤️</div>
                                <div class="preset-info">
                                    <div class="preset-title">中班</div>
                                    <div class="preset-time">12:00 - 21:00</div>
                                </div>
                            </button>
                            
                            <button class="time-preset-card" onclick="selectSmartTime('09:00', '18:00')">
                                <div class="preset-icon">⏰</div>
                                <div class="preset-info">
                                    <div class="preset-title">全天班</div>
                                    <div class="preset-time">09:00 - 18:00</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> 工作日</label>
                        <div class="weekdays-selector" id="smartWeekdays">
                            <!-- 工作日选择器 -->
                        </div>
                        <div class="quick-day-buttons">
                            <button class="day-preset" onclick="setAllWeekdaysSmart()">全选工作日</button>
                            <button class="day-preset" onclick="selectWeekdaysByPattern('weekdays')">工作日(一至五)</button>
                            <button class="day-preset" onclick="selectWeekdaysByPattern('weekend')">周末班</button>
                            <button class="day-preset" onclick="clearWeekdaysSmart()">清除所有</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-alt"></i> 应用周数</label>
                        <select id="smartWeeks" class="select-input">
                            <option value="1">本周</option>
                            <option value="2">2周</option>
                            <option value="4" selected>4周</option>
                        </select>
                    </div>
                    
                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <span>将为选中的员工组批量设置相同的工作时间</span>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-primary" onclick="applySmartSchedule()">
                        <i class="fas fa-bolt"></i> 应用智能排班
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-share-alt"></i> 分享选项</h3>
                <button class="modal-close" onclick="closeModal('exportModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="export-option" onclick="copyScheduleAsText()">
                        <div class="export-icon">
                            <i class="fas fa-copy"></i>
                        </div>
                        <div class="export-info">
                            <strong>复制文本格式</strong>
                            <small>适合粘贴到微信、短信</small>
                        </div>
                    </div>
                    
                    <div class="export-option" onclick="printSchedule()">
                        <div class="export-icon">
                            <i class="fas fa-print"></i>
                        </div>
                        <div class="export-info">
                            <strong>打印排班表</strong>
                            <small>直接打印或保存为PDF</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Today's Schedule Modal -->
    <div class="modal" id="todayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-day"></i> 今日排班</h3>
                <button class="modal-close" onclick="closeModal('todayModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="today-list" id="todayList">
                    <!-- 今日排班列表 -->
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> 工时统计</h3>
                <button class="modal-close" onclick="closeModal('statsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="statsGrid">
                    <!-- 统计信息 -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Schedule Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> 编辑排班</h3>
                <button class="modal-close" onclick="closeModal('editModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="editScheduleContent">
                    <!-- 编辑排班内容 -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB6C3s4EAPEx0GBLnBXAz4aYJfoCBEyofc",
            authDomain: "employee-schedule-893f5.firebaseapp.com",
            databaseURL: "https://employee-schedule-893f5-default-rtdb.firebaseio.com",
            projectId: "employee-schedule-893f5",
            storageBucket: "employee-schedule-893f5.firebasestorage.app",
            messagingSenderId: "377051530021",
            appId: "1:377051530021:web:e3341a1a7bcdc89ad810cc"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // 检查连接状态
        database.ref('.info/connected').on('value', (snap) => {
            const status = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                status.innerHTML = '<i class="fas fa-wifi"></i><span>已连接</span>';
                status.className = 'connection-status connected';
            } else {
                status.innerHTML = '<i class="fas fa-wifi-slash"></i><span>未连接</span>';
                status.className = 'connection-status disconnected';
            }
        });
    </script>

    <!-- Main JavaScript -->
    <script src="app.js"></script>
</body>
</html>
