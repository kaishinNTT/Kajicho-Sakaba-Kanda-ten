<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能排班系统</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar for Desktop -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-calendar-alt"></i>
                <h2>智能排班</h2>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>总览</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('employees')">
                    <i class="fas fa-users"></i>
                    <span>员工管理</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('weekly')">
                    <i class="fas fa-calendar-week"></i>
                    <span>本周排班</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('quick-schedule')">
                    <i class="fas fa-bolt"></i>
                    <span>快速排班</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('edit-schedule')">
                    <i class="fas fa-edit"></i>
                    <span>编辑排班</span>
                </a>
            </nav>
            
            <div class="status-info">
                <div class="status-item">
                    <i class="fas fa-user-friends"></i>
                    <span id="totalEmployeesStat">0</span>
                    <small>员工</small>
                </div>
                <div class="status-item">
                    <i class="fas fa-calendar-check"></i>
                    <span id="weeklyShiftsStat">0</span>
                    <small>本周班次</small>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Mobile Header -->
            <header class="mobile-header">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>智能排班系统</h1>
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi"></i>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2><i class="fas fa-home"></i> 总览面板</h2>
                    <div class="header-actions">
                        <button class="btn btn-sm" onclick="refreshData()">
                            <i class="fas fa-sync"></i> 刷新
                        </button>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon bg-blue">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalEmployees">0</h3>
                            <p>总员工数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-green">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="todayShifts">0</h3>
                            <p>今日班次</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-purple">
                            <i class="fas fa-door-open"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="frontDeskCount">0</h3>
                            <p>前台/服务区</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon bg-orange">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="kitchenCount">0</h3>
                            <p>厨房区</p>
                        </div>
                    </div>
                </div>

                <!-- Employee Quick View -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-search"></i> 快速查看员工排班</h3>
                        <button class="btn btn-primary" onclick="showQuickLookup()">
                            <i class="fas fa-eye"></i> 查看详情
                        </button>
                    </div>
                    <div class="card-body">
                        <select id="quickLookupSelect" class="select-input" onchange="showEmployeeWeeklyView(this.value)">
                            <option value="">选择员工查看本周排班</option>
                        </select>
                        <div id="employeeWeeklyPreview" class="week-preview">
                            <!-- 员工本周排班预览 -->
                        </div>
                    </div>
                </div>

                <!-- Today's Schedule -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-day"></i> 今日排班</h3>
                        <span class="date-badge">今天</span>
                    </div>
                    <div class="card-body">
                        <div id="todaysSchedule" class="schedule-list">
                            <!-- 今日排班列表 -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Employees Management Section -->
            <section id="employees" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> 员工管理</h2>
                    <button class="btn btn-primary" onclick="showAddEmployeeModal()">
                        <i class="fas fa-plus"></i> 添加员工
                    </button>
                </div>

                <div class="card">
                    <div class="employee-grid" id="employeeGrid">
                        <!-- 员工列表 -->
                    </div>
                </div>
            </section>

            <!-- Weekly Schedule View -->
            <section id="weekly" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-calendar-week"></i> 本周排班总览</h2>
                    <div class="week-selector">
                        <button class="btn btn-sm" onclick="changeWeek(-1)">
                            <i class="fas fa-chevron-left"></i> 上周
                        </button>
                        <span id="currentWeekRange">本周</span>
                        <button class="btn btn-sm" onclick="changeWeek(1)">
                            下周 <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="weekly-grid" id="weeklyGrid">
                    <!-- 周排班表格 -->
                </div>
            </section>

            <!-- Quick Schedule Section -->
            <section id="quick-schedule" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-bolt"></i> 快速排班</h2>
                    <p class="subtitle">一键设置员工整周排班</p>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="quick-schedule-form">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> 选择员工</label>
                                <select id="quickScheduleEmployee" class="select-input">
                                    <option value="">选择员工</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-calendar"></i> 开始日期</label>
                                <input type="date" id="quickStartDate" class="input-field" value="">
                            </div>

                            <div class="time-settings">
                                <h4><i class="fas fa-clock"></i> 工作时间设置</h4>
                                <div class="time-inputs">
                                    <div class="time-group">
                                        <label>上班时间</label>
                                        <input type="time" id="quickStartTime" class="time-field" value="08:00">
                                    </div>
                                    <div class="time-group">
                                        <label>下班时间</label>
                                        <input type="time" id="quickEndTime" class="time-field" value="17:00">
                                    </div>
                                </div>
                            </div>

                            <div class="week-settings">
                                <h4><i class="fas fa-calendar-check"></i> 工作日选择</h4>
                                <div class="weekday-selector" id="weekdaySelector">
                                    <!-- 星期选择器 -->
                                </div>
                            </div>

                            <div class="action-buttons">
                                <button class="btn btn-success btn-lg" onclick="applyQuickSchedule()">
                                    <i class="fas fa-check-circle"></i> 应用排班
                                </button>
                                <button class="btn btn-secondary" onclick="previewQuickSchedule()">
                                    <i class="fas fa-eye"></i> 预览
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> 最近设置</h3>
                    </div>
                    <div id="quickScheduleHistory" class="card-body">
                        <!-- 最近快速排班记录 -->
                    </div>
                </div>
            </section>

            <!-- Edit Schedule Section -->
            <section id="edit-schedule" class="content-section">
                <div class="section-header">
                    <h2><i class="fas fa-edit"></i> 排班编辑</h2>
                    <div class="filter-controls">
                        <select id="editFilterEmployee" class="select-sm" onchange="loadEmployeeSchedule()">
                            <option value="">选择员工</option>
                        </select>
                        <select id="editFilterWeek" class="select-sm" onchange="loadEmployeeSchedule()">
                            <option value="this">本周</option>
                            <option value="next">下周</option>
                            <option value="all">全部</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div id="editScheduleContainer">
                            <div class="empty-state">
                                <i class="fas fa-calendar-edit"></i>
                                <h3>选择员工编辑排班</h3>
                                <p>在左侧选择员工开始编辑本周排班</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> 添加新员工</h3>
                <button class="modal-close" onclick="closeModal('addEmployeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>员工姓名</label>
                    <input type="text" id="newEmployeeName" class="input-field" placeholder="请输入姓名">
                </div>
                <div class="form-group">
                    <label>职位</label>
                    <div class="position-selector">
                        <label class="position-option">
                            <input type="radio" name="position" value="前台/服务区" checked>
                            <div class="position-card">
                                <i class="fas fa-door-open"></i>
                                <span>前台/服务区</span>
                            </div>
                        </label>
                        <label class="position-option">
                            <input type="radio" name="position" value="厨房区">
                            <div class="position-card">
                                <i class="fas fa-utensils"></i>
                                <span>厨房区</span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="addNewEmployee()">
                        <i class="fas fa-plus"></i> 添加员工
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Employee Schedule View Modal -->
    <div id="employeeScheduleModal" class="modal modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEmployeeName">员工排班详情</h3>
                <button class="modal-close" onclick="closeModal('employeeScheduleModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="employeeScheduleDetail">
                    <!-- 员工排班详情 -->
                </div>
            </div>
        </div>
    </div>

    <!-- Day Edit Modal -->
    <div id="dayEditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-day"></i> 编辑排班</h3>
                <button class="modal-close" onclick="closeModal('dayEditModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>员工</label>
                    <div class="employee-display" id="editDayEmployee">
                        <!-- 员工信息 -->
                    </div>
                </div>
                <div class="form-group">
                    <label>日期</label>
                    <div class="date-display" id="editDayDate">
                        <!-- 日期信息 -->
                    </div>
                </div>
                <div class="form-group">
                    <label>排班类型</label>
                    <div class="schedule-type-selector">
                        <label class="type-option">
                            <input type="radio" name="scheduleType" value="work" checked>
                            <div class="type-card">
                                <i class="fas fa-briefcase"></i>
                                <span>上班</span>
                            </div>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="scheduleType" value="rest">
                            <div class="type-card">
                                <i class="fas fa-umbrella-beach"></i>
                                <span>休息</span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="time-inputs" id="timeInputsSection">
                    <div class="form-group">
                        <label>上班时间</label>
                        <input type="time" id="editDayStartTime" class="input-field" value="08:00">
                    </div>
                    <div class="form-group">
                        <label>下班时间</label>
                        <input type="time" id="editDayEndTime" class="input-field" value="17:00">
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-success" onclick="saveDayEdit()">
                        <i class="fas fa-save"></i> 保存更改
                    </button>
                    <button class="btn btn-danger" onclick="deleteDaySchedule()" id="deleteDayBtn">
                        <i class="fas fa-trash"></i> 删除排班
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB6C3s4EAPEx0GBLnBXAz4aYJfoCBEyofc",
            authDomain: "employee-schedule-893f5.firebaseapp.com",
            databaseURL: "https://employee-schedule-893f5-default-rtdb.firebaseio.com",
            projectId: "employee-schedule-893f5",
            storageBucket: "employee-schedule-893f5.firebasestorage.app",
            messagingSenderId: "377051530021",
            appId: "1:377051530021:web:e3341a1a7bcdc89ad810cc"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Connection status
        database.ref('.info/connected').on('value', (snap) => {
            const status = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                status.innerHTML = '<i class="fas fa-wifi"></i>';
                status.style.color = '#4CAF50';
            } else {
                status.innerHTML = '<i class="fas fa-wifi-slash"></i>';
                status.style.color = '#f44336';
            }
        });
    </script>

    <!-- Main JavaScript -->
    <script src="app.js"></script>
</body>
</html>
