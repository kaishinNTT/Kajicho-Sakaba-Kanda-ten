<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Kajicho Kanda - Qu·∫£n l√Ω l·ªãch l√†m vi·ªác</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">
    <style>
        /* Th√™m loading screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-spinner"></div>
        <h2>ƒêang t·∫£i ·ª©ng d·ª•ng...</h2>
        <p style="margin-top: 10px; opacity: 0.8;">Kajicho Kanda Schedule</p>
    </div>

    <!-- Main App -->
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-calendar-alt"></i> Kajicho Kanda</h1>
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi"></i>
                    <span>ƒê√£ k·∫øt n·ªëi</span>
                </div>
            </div>
            <div class="current-date" id="currentDate"></div>
        </header>

        <!-- Main Navigation -->
        <nav class="main-nav">
            <button class="nav-btn active" data-view="employees" onclick="switchView('employees')">
                <i class="fas fa-users"></i>
                <span>Nh√¢n vi√™n</span>
            </button>
            <button class="nav-btn" data-view="weekly" onclick="switchView('weekly')">
                <i class="fas fa-calendar-week"></i>
                <span>Tu·∫ßn n√†y</span>
            </button>
            <button class="nav-btn" data-view="schedule" onclick="switchView('schedule')">
                <i class="fas fa-plus-circle"></i>
                <span>X·∫øp l·ªãch</span>
            </button>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- EMPLOYEES VIEW -->
            <div class="view active" id="employeesView">
                <div class="view-header">
                    <h2><i class="fas fa-users"></i> Qu·∫£n l√Ω nh√¢n vi√™n</h2>
                    <div class="view-actions">
                        <button class="btn-icon" onclick="showAddEmployee()" title="Th√™m nh√¢n vi√™n">
                            <i class="fas fa-user-plus"></i>
                        </button>
                        <button class="btn-icon" onclick="refreshData()" title="L√†m m·ªõi d·ªØ li·ªáu">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>

                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="employeeSearch" placeholder="T√¨m nh√¢n vi√™n..." oninput="searchEmployees()">
                </div>

                <div class="position-filter">
                    <button class="filter-btn active" onclick="filterEmployees('all')">T·∫•t c·∫£</button>
                    <button class="filter-btn" onclick="filterEmployees('ÂâçÂè∞/ÊúçÂä°Âå∫')">Qu·∫ßy/D·ªãch v·ª•</button>
                    <button class="filter-btn" onclick="filterEmployees('Âé®ÊàøÂå∫')">B·∫øp</button>
                </div>

                <div class="employee-cards" id="employeeCards">
                    <!-- Th·∫ª nh√¢n vi√™n s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </div>
            </div>

            <!-- WEEKLY SCHEDULE VIEW -->
            <div class="view" id="weeklyView">
                <div class="view-header">
                    <h2><i class="fas fa-calendar-week"></i> L·ªãch tu·∫ßn n√†y</h2>
                    <div class="week-nav">
                        <button class="btn-icon" onclick="changeWeek(-1)" title="Tu·∫ßn tr∆∞·ªõc">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="weekRange">Tu·∫ßn n√†y</span>
                        <button class="btn-icon" onclick="changeWeek(1)" title="Tu·∫ßn sau">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="weekly-schedule-container">
                    <div class="weekly-schedule" id="weeklySchedule">
                        <!-- L·ªãch tu·∫ßn s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                    </div>
                </div>
            </div>

            <!-- SCHEDULE VIEW -->
            <div class="view" id="scheduleView">
                <div class="view-header">
                    <h2><i class="fas fa-plus-circle"></i> Th√™m l·ªãch l√†m vi·ªác</h2>
                </div>

                <div class="schedule-form">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Ch·ªçn nh√¢n vi√™n</label>
                        <select id="scheduleEmployee" class="select-input">
                            <option value="">Ch·ªçn nh√¢n vi√™n</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-calendar"></i> Ng√†y</label>
                        <input type="date" id="scheduleDate" class="input-field">
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Th·ªùi gian l√†m vi·ªác</label>
                        <div class="time-range-group">
                            <div class="time-range-inputs">
                                <input type="time" id="scheduleStart" class="input-field" value="12:00">
                                <span class="time-separator">ƒë·∫øn</span>
                                <input type="time" id="scheduleEnd" class="input-field" value="00:00">
                            </div>
                            <div class="quick-time-buttons">
                                <button type="button" class="time-preset" onclick="setTimePreset('12:00', '00:00')">C·∫£ ng√†y</button>
                                <button type="button" class="time-preset" onclick="setTimePreset('18:00', '00:00')">T·ªëi</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-tag"></i> Lo·∫°i</label>
                        <div class="type-selector">
                            <button type="button" class="type-btn active" data-type="work" onclick="selectScheduleType('work')">
                                <i class="fas fa-briefcase"></i>
                                <span>L√†m vi·ªác</span>
                            </button>
                            <button type="button" class="type-btn" data-type="rest" onclick="selectScheduleType('rest')">
                                <i class="fas fa-umbrella-beach"></i>
                                <span>Ngh·ªâ</span>
                            </button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button type="button" class="btn-primary" onclick="addSchedule()">
                            <i class="fas fa-check"></i> Th√™m l·ªãch
                        </button>
                        <button type="button" class="btn-secondary" onclick="showQuickWeekModal()">
                            <i class="fas fa-calendar-week"></i> X·∫øp c·∫£ tu·∫ßn
                        </button>
                        <button type="button" class="btn-secondary btn-rest-day" onclick="showSetRestDaysModal()">
                            <i class="fas fa-umbrella-beach"></i> ƒê·∫∑t ng√†y ngh·ªâ
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Quick Actions Bar -->
        <div class="quick-actions-bar">
            <button type="button" class="quick-action" onclick="showTodaySchedule()">
                <i class="fas fa-calendar-day"></i>
                <span>H√¥m nay</span>
            </button>
            <button type="button" class="quick-action" onclick="showStats()">
                <i class="fas fa-chart-bar"></i>
                <span>Th·ªëng k√™</span>
            </button>
            <button type="button" class="quick-action" onclick="printAllSchedule()">
                <i class="fas fa-print"></i>
                <span>In tu·∫ßn</span>
            </button>
        </div>
    </div>

    <!-- MODALS -->
    <!-- Employee Detail Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalEmployeeName"></h3>
                <button type="button" class="modal-close" onclick="closeModal('employeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="employee-detail-info">
                    <div class="employee-basic">
                        <div class="info-row">
                            <span class="label">Ch·ª©c v·ª•</span>
                            <span class="value" id="modalEmployeePosition"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Gi·ªù tu·∫ßn n√†y</span>
                            <span class="value" id="modalWeekHours">0 gi·ªù</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Gi·ªù th√°ng n√†y</span>
                            <span class="value" id="modalMonthHours">0 gi·ªù</span>
                        </div>
                    </div>

                    <div class="week-summary">
                        <h4><i class="fas fa-calendar-week"></i> L·ªãch tu·∫ßn n√†y</h4>
                        <div class="week-days" id="employeeWeekDays">
                            <!-- Weekly schedule view -->
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-action" onclick="editEmployeeSchedule()">
                            <i class="fas fa-edit"></i> S·ª≠a l·ªãch
                        </button>
                        
                        <div class="split-buttons">
                            <button type="button" class="btn-action" onclick="copyEmployeeSchedule()">
                                <i class="fas fa-copy"></i> Sao ch√©p
                            </button>
                            <button type="button" class="btn-action" onclick="printEmployeeSchedule()">
                                <i class="fas fa-print"></i> In l·ªãch
                            </button>
                        </div>
                        
                        <button type="button" class="btn-action btn-danger" onclick="deleteCurrentEmployee()">
                            <i class="fas fa-trash"></i> X√≥a nh√¢n vi√™n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div class="modal" id="addEmployeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Th√™m nh√¢n vi√™n</h3>
                <button type="button" class="modal-close" onclick="closeModal('addEmployeeModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="newEmployeeName" class="input-field" placeholder="Nh·∫≠p t√™n nh√¢n vi√™n" autofocus>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-briefcase"></i> Ch·ª©c v·ª•</label>
                    <div class="position-select">
                        <button type="button" class="position-option active" data-position="ÂâçÂè∞/ÊúçÂä°Âå∫" onclick="selectPosition(this)">
                            <i class="fas fa-door-open"></i>
                            <span>Qu·∫ßy/D·ªãch v·ª•</span>
                        </button>
                        <button type="button" class="position-option" data-position="Âé®ÊàøÂå∫" onclick="selectPosition(this)">
                            <i class="fas fa-utensils"></i>
                            <span>B·∫øp</span>
                        </button>
                    </div>
                </div>
                <button type="button" class="btn-primary full-width" onclick="addEmployee()">
                    <i class="fas fa-plus"></i> Th√™m nh√¢n vi√™n
                </button>
            </div>
        </div>
    </div>

    <!-- Quick Week Schedule Modal -->
    <div class="modal" id="quickWeekModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-week"></i> X·∫øp l·ªãch c·∫£ tu·∫ßn</h3>
                <button type="button" class="modal-close" onclick="closeModal('quickWeekModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="quick-week-options">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Ch·ªçn nh√¢n vi√™n</label>
                        <select id="quickWeekEmployee" class="select-input">
                            <option value="">Ch·ªçn nh√¢n vi√™n</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-clock"></i> Gi·ªù l√†m vi·ªác</label>
                        <div class="time-group">
                            <input type="time" id="quickWeekStart" class="input-field" value="08:00">
                            <span class="time-separator">ƒë·∫øn</span>
                            <input type="time" id="quickWeekEnd" class="input-field" value="17:00">
                        </div>
                        <div class="quick-time-buttons">
                            <button type="button" class="time-preset" onclick="setQuickTimePreset('08:00', '17:00')">S√°ng</button>
                            <button type="button" class="time-preset" onclick="setQuickTimePreset('12:00', '21:00')">Chi·ªÅu</button>
                            <button type="button" class="time-preset" onclick="setQuickTimePreset('09:00', '18:00')">C·∫£ ng√†y</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> ƒê·∫∑t ng√†y l√†m vi·ªác</label>
                        <div class="weekdays-selector" id="weekdaysSelector">
                            <!-- Weekday selector -->
                        </div>
                        <div class="quick-day-buttons">
                            <button type="button" class="day-preset" onclick="setAllWeekdays()">Ch·ªçn t·∫•t c·∫£</button>
                            <button type="button" class="day-preset" onclick="setAllAsRest()">T·∫•t c·∫£ ngh·ªâ</button>
                            <button type="button" class="day-preset" onclick="clearWeekdays()">B·ªè ch·ªçn</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="applyQuickWeekSchedule()">
                        <i class="fas fa-check"></i> √Åp d·ª•ng l·ªãch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Set Rest Days Modal -->
    <div class="modal" id="setRestDaysModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-umbrella-beach"></i> ƒê·∫∑t ng√†y ngh·ªâ</h3>
                <button type="button" class="modal-close" onclick="closeModal('setRestDaysModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="rest-days-options">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Ch·ªçn nh√¢n vi√™n</label>
                        <select id="restDaysEmployee" class="select-input">
                            <option value="">Ch·ªçn nh√¢n vi√™n</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-calendar-check"></i> Ch·ªçn ng√†y ngh·ªâ</label>
                        <div class="weekdays-selector" id="restDaysSelector">
                            <!-- Rest days selector -->
                        </div>
                        <div class="quick-day-buttons">
                            <button type="button" class="day-preset" onclick="setAllRestDays()">T·∫•t c·∫£ ngh·ªâ</button>
                            <button type="button" class="day-preset" onclick="clearRestDays()">B·ªè ch·ªçn</button>
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="applyRestDays()">
                        <i class="fas fa-umbrella-beach"></i> √Åp d·ª•ng ng√†y ngh·ªâ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Today's Schedule Modal -->
    <div class="modal" id="todayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-day"></i> L·ªãch h√¥m nay</h3>
                <button type="button" class="modal-close" onclick="closeModal('todayModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="today-list" id="todayList">
                    <!-- Today's schedule list -->
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-chart-bar"></i> Th·ªëng k√™ gi·ªù l√†m</h3>
                <button type="button" class="modal-close" onclick="closeModal('statsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats information -->
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Schedule Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> S·ª≠a l·ªãch</h3>
                <button type="button" class="modal-close" onclick="closeModal('editModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="editScheduleContent">
                    <!-- Edit schedule content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB6C3s4EAPEx0GBLnBXAz4aYJfoCBEyofc",
            authDomain: "employee-schedule-893f5.firebaseapp.com",
            databaseURL: "https://employee-schedule-893f5-default-rtdb.firebaseio.com",
            projectId: "employee-schedule-893f5",
            storageBucket: "employee-schedule-893f5.firebasestorage.app",
            messagingSenderId: "377051530021",
            appId: "1:377051530021:web:e3341a1a7bcdc89ad810cc"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            
            // Ki·ªÉm tra k·∫øt n·ªëi
            database.ref('.info/connected').on('value', (snap) => {
                const status = document.getElementById('connectionStatus');
                if (snap.val() === true) {
                    status.innerHTML = '<i class="fas fa-wifi"></i><span>ƒê√£ k·∫øt n·ªëi</span>';
                    status.className = 'connection-status connected';
                } else {
                    status.innerHTML = '<i class="fas fa-wifi-slash"></i><span>M·∫•t k·∫øt n·ªëi</span>';
                    status.className = 'connection-status disconnected';
                }
            });
            
            console.log("‚úÖ Firebase ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o");
        } catch (error) {
            console.error("‚ùå L·ªói kh·ªüi t·∫°o Firebase:", error);
            showMessage("L·ªói k·∫øt n·ªëi c∆° s·ªü d·ªØ li·ªáu", "error");
        }
        
        // ·∫®n loading screen khi trang t·∫£i xong
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 500);
        });
    </script>

    <!-- Main JavaScript -->
    <script src="app.js"></script>
</body>
</html>
